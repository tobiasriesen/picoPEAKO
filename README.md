# picoPEAKO - A Python Library for Data Processing and Analysis

[![CI](https://github.com/tobiasriesen/picoPEAKO/actions/workflows/ci.yml/badge.svg)](https://github.com/tobiasriesen/picoPEAKO/actions/workflows/ci.yml) [![Lint with flake8](https://github.com/tobiasriesen/picoPEAKO/actions/workflows/flake8.yml/badge.svg)](https://github.com/tobiasriesen/picoPEAKO/actions/workflows/flake8.yml)

Replacement for the original `pyPEAKO` library with a smaller and cleaner code base. See their [GitHub repository](https://github.com/ti-vo/pyPEAKO) for more details.

## Installation

You can install the library using `pip` over `git`:

```bash
pip install git+https://github.com/tobiasriesen/picoPEAKO.git
```

## Examples

### Get Data

The script works on data files in the `netCDF4` format as created by the [`rpgpy`](https://github.com/actris-cloudnet/rpgpy) software. To create `netCDF4` files from level zero data, install the software with `pip install rpgpy` and run

```python
from rpgpy import rpg2nc
rpg2nc('some/rpg/level_zero_file.LV0', 'output/netcdf_file.nc')
```

### Generate Training Data

From NetCDF files, training data can be generated by manually labeling the peaks in the spectra. For this, pyPEAKO provides a simple GUI:

```python
import picopeako as pp

specfiles_in = ['path/to/netcdf_file1.nc', 'path/to/netcdf_file2.nc']
training_data = pp.TrainingData(specfiles_in, 4)
training_data.mark_random_spectra()
training_data.save_training_data()
```

### Training the model

When training data is available, a model can be trained by using the files.

```python
import picopeako as pp

data_files = ['path/to/netcdf_file1.nc', 'path/to/netcdf_file2.nc']
ground_truth_files = ['path/to/ground_truth/netcdf_file1.nc', 'path/to/ground_truth/netcdf_file2.nc']

param_candidate_values = {
    't_avg': [0, 1],
    'h_avg': [0, 1],
    'span': [0, 2, 3],
    'polyorder': [1, 2],
    'width': [0.5, 1, 2],
    'prom': [0.0, 0.5, 1]
}

peako = pp.Peako()
peako.train_from_files(data_files, ground_truth_files, param_candidate_values)
peako.save_model('path/to/save/peako_model.json')
```
